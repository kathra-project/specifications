swagger: "2.0"
info:
  title: Kathra Core Model
  version: 1.1.0-SNAPSHOT
  x-artifactName: core
  x-groupId: org.kathra
definitions:
  RESOURCE_STATUS:
    type: string
    enum:
    - PENDING
    - READY
    - UPDATING
    - UNSTABLE
    - ERROR
    - DELETED
  PROGRAMMING_LANGUAGE:
    type: string
    enum:
    - JAVA
    - PYTHON
  LIBRARY_TYPE:
    type: string
    enum:
    - MODEL
    - INTERFACE
    - CLIENT
  PACKAGE_TEMPLATE:
    type: string
    enum:
      - REST_API
  PACKAGE_TYPE:
    type: string
    enum:
      - HELM
  PIPELINE_TEMPLATE:
    type: string
    enum:
    - JAVA_LIBRARY
    - PYTHON_LIBRARY
    - JAVA_SERVICE
    - PYTHON_SERVICE
    - DOCKER_SERVICE
    - HELM_PACKAGE
  Resource:
    type: object
    properties:
      id:
        type: string
      name:
        type: string
      status:
        enum:
        - PENDING
        - READY
        - UPDATING
        - UNSTABLE
        - ERROR
        - DELETED
      createdBy:
        type: string
      updatedBy:
        type: string
      createdAt:
        type: integer
      updatedAt:
        type: integer
      metadata:
        type: object
        additionalProperties:
          type: object
  Component:
    allOf:
    - $ref: '#/definitions/Resource'
    - type: object
      properties:
        description:
          type: string
        title:
          type: string
        versions:
          type: array
          items:
            $ref: '#/definitions/ApiVersion'
        libraries:
          type: array
          items:
            $ref: '#/definitions/Library'
        implementations:
          type: array
          items:
            $ref: '#/definitions/Implementation'
        apiRepository:
          $ref: '#/definitions/SourceRepository'
  Asset:
    allOf:
    - $ref: '#/definitions/Resource'
    - type: object
      properties:
        sourceRepository:
          $ref: '#/definitions/SourceRepository'
        pipeline:
          $ref: '#/definitions/Pipeline'
  Library:
    allOf:
    - $ref: '#/definitions/Asset'
    - type: object
      properties:
        language:
          enum:
            - JAVA
            - PYTHON
        component:
          $ref: '#/definitions/Component'
        type:
          enum:
          - MODEL
          - INTERFACE
          - CLIENT
        versions:
          type: array
          items:
            $ref: '#/definitions/LibraryApiVersion'
  Implementation:
    allOf:
    - $ref: '#/definitions/Asset'
    - type: object
      properties:
        language:
          enum:
            - JAVA
            - PYTHON
        description:
          type: string
        title:
          type: string
        versions:
          type: array
          items:
            $ref: '#/definitions/ImplementationVersion'
  ImplementationVersion:
    allOf:
    - $ref: '#/definitions/Resource'
    - type: object
      properties:
        sourceRepo:
          $ref: '#/definitions/SourceRepository'
        version:
          type: string
        implementation:
          $ref: '#/definitions/Implementation'
        apiVersion:
          $ref: '#/definitions/ApiVersion'
  ApiVersion:
    allOf:
    - $ref: '#/definitions/Resource'
    - type: object
      properties:
        component:
          $ref: '#/definitions/Component'
        released:
          type: boolean
        version:
          type: string
        apiRepositoryStatus:
          enum:
          - PENDING
          - READY
          - UPDATING
          - UNSTABLE
          - ERROR
          - DELETED
        librariesApiVersions:
          type: array
          items:
            $ref: '#/definitions/LibraryApiVersion'
        implementationsVersions:
          type: array
          items:
            $ref: '#/definitions/ImplementationVersion'
  LibraryApiVersion:
    allOf:
    - $ref: '#/definitions/Resource'
    - type: object
      properties:
        library:
          $ref: '#/definitions/Library'
        apiVersion:
          $ref: '#/definitions/ApiVersion'
        apiRepositoryStatus:
          enum:
          - PENDING
          - READY
          - UPDATING
          - UNSTABLE
          - ERROR
          - DELETED
        pipelineStatus:
          enum:
          - PENDING
          - READY
          - UPDATING
          - UNSTABLE
          - ERROR
          - DELETED
  SourceRepository:
    allOf:
    - $ref: '#/definitions/Resource'
    - type: object
      properties:
        provider:
          type: string
        providerId:
          type: string
        path:
          type: string
        sshUrl:
          type: string
        httpUrl:
          type: string
        webUrl:
          type: string
        branchs:
          type: array
          items:
            type: string
  Pipeline:
    allOf:
    - $ref: '#/definitions/Resource'
    - type: object
      properties:
        provider:
          type: string
        providerId:
          type: string
        credentialId:
          type: string
        path:
          type: string
        sourceRepository:
          $ref: '#/definitions/SourceRepository'
        template:
          enum:
          - JAVA_LIBRARY
          - PYTHON_LIBRARY
          - JAVA_SERVICE
          - PYTHON_SERVICE
          - DOCKER_SERVICE
          - HELM_PACKAGE
  Group:
    allOf:
    - $ref: '#/definitions/Resource'
    - type: object
      properties:
        path:
          type: string
          description: Group's path in case of subgroup
        members:
          type: array
          items:
            $ref: '#/definitions/Assignation'
        parent:
          $ref: '#/definitions/Group'
        sourceRepositoryStatus:
          enum:
          - PENDING
          - READY
          - UPDATING
          - UNSTABLE
          - ERROR
          - DELETED
        sourceMembershipStatus:
          enum:
          - PENDING
          - READY
          - UPDATING
          - UNSTABLE
          - ERROR
          - DELETED
        pipelineFolderStatus:
          enum:
          - PENDING
          - READY
          - UPDATING
          - UNSTABLE
          - ERROR
          - DELETED
        binaryRepositoryStatus:
          enum:
          - PENDING
          - READY
          - UPDATING
          - UNSTABLE
          - ERROR
          - DELETED
  KeyPair:
    allOf:
    - $ref: '#/definitions/Resource'
    - type: object
      properties:
        private:
          type: string
        public:
          type: string
        group:
          $ref: '#/definitions/Group'
  User:
    allOf:
    - $ref: '#/definitions/Resource'
    - type: object
      properties:
        firstName:
          type: string
        lastName:
          type: string
        email:
          type: string
        password:
          type: string
        phone:
          type: string
        groups:
          type: array
          items:
            $ref: '#/definitions/Assignation'
  Assignation:
    allOf:
    - $ref: '#/definitions/Resource'
    - type: object
      properties:
        role:
          type: string
        fte:
          type: string
  SourceRepositoryCommit:
    type: object
    properties:
      id:
        type: string
      shortId:
        type: string
      title:
        type: string
      authorName:
        type: string
      authorEmail:
        type: string
      createdAt:
        type: string
      committerName:
        type: string
      committerEmail:
        type: string
      message:
        type: string
  Membership:
    type: object
    properties:
      path:
        type: string
      memberType:
        type: string
        enum:
        - user
        - group
      memberName:
        type: string
      role:
        type: string
        enum:
        - guest
        - contributor
        - manager
  CatalogEntry:
    allOf:
      - $ref: '#/definitions/Resource'
      - type: object
        properties:
          template:
            enum:
              - REST_API
          packages:
            type: array
            items:
              $ref: '#/definitions/CatalogEntryPackage'

  CatalogEntryPackageVersion:
    allOf:
      - $ref: '#/definitions/Resource'
      - type: object
        properties:
          version:
            type: "string"
            description: "Version"
          arguments:
            type: "array"
            description: "Catalog entry arguments"
            items:
              $ref: "#/definitions/CatalogEntryArgument"
          documentation:
            type: "string"
            description: "Documentation of catalog entry (Markdown)"
          provider:
            type: "string"
            description: "Provider type"
          providerId:
            type: "string"
            description: "Uniq identifier generated by provider"
        example:
          version: "6.5.4"
          provider: "helm"
          description: "Chart for PostgreSQL, an object-relational database manag..."
          providerId: "stable/postgresql@6.5.4"
          documentation: "# PostgreSQL
            [PostgreSQL](https://www.postgresql.org/) is an object-relational database management system (ORDBMS) with an emphasis on extensibility and on standards-compliance.
            ## TL;DR;
            ```console
            $ helm install stable/postgresql
            ```
            ## Introduction
            This chart bootstraps a [PostgreSQL](https://github.com/bitnami/bitnami-docker-postgresql) deployment on a [Kubernetes](http://kubernetes.io) cluster using the [Helm](https://helm.sh) package manager.
            Bitnami charts can be used with [Kubeapps](https://kubeapps.com/) for deployment and management of Helm Charts in clusters. This chart has been tested to work with NGINX Ingress, cert-manager, fluentd and Prometheus on top of the [BKPR](https://kubeprod.io/).
            .. .. .
            "
          arguments:
            - label: "global.postgresql.postgresqlDatabase"
              description: "PostgreSQL database (overrides postgresqlDatabase)"
              contrainst: ".*"
              value: "nil"
              key: "global.postgresql.postgresqlDatabase"
            - label: "global.postgresql.postgresqlUsername"
              description: "PostgreSQL usernmae (overrides postgresqlUsername)"
              contrainst: ".*"
              value: "nil"
              key: "global.postgresql.postgresqlUsername"
  CatalogEntryPackage:
    allOf:
      - $ref: '#/definitions/Asset'
      - type: object
        properties:
          type:
            enum:
              - HELM
          version:
            type: array
            items:
              $ref: '#/definitions/CatalogEntryPackageVersion'
          asset:
            $ref: '#/definitions/Asset'
          providerId:
            type: "string"
            description: "Uniq identifier generated by provider"
        example:
          id: "<uuid>"
          name: "postgresql"
          asset:
            id: "<uuid>"
          sourceRepository:
            id: "<uuid>"
          pipeline:
            id: "<uuid>"
          provider: "helm"
          versions:
            - id: "<uuid>"
              version: "1.0.0"
            - id: "<uuid>"
              version: "1.1.0"
  CatalogEntryArgument:
    type: "object"
    properties:
      label:
        type: "string"
        description: "Readable argument for catalog entry"
      description:
        type: "string"
        description: "Description argument for catalog entry"
      key:
        type: "string"
        description: "Argument key for catalog entry"
      value:
        type: "string"
        description: "Argument value for catalog entry"
      contrainst:
        type: "string"
        description: "Argument constraint for catalog entry"
    example:
      label: "global.postgresql.postgresqlUsername"
      description: "PostgreSQL database (overrides postgresqlDatabase)"
      contrainst: ".*"
      value: ""
      key: "global.postgresql.postgresqlDatabase"
paths: {}

